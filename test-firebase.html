<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Test</title>
</head>
<body>
    <h1>Firebase Connection Test</h1>
    <div id="status">Testing Firebase connection...</div>
    <div id="messages"></div>
    
    <script type="module">
        import { app, db } from './firebase-config.js';
        import { 
            collection, 
            addDoc, 
            onSnapshot, 
            serverTimestamp, 
            query, 
            orderBy,
            limit 
        } from 'https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js';
        
        console.log('Firebase App:', app);
        console.log('Firebase DB:', db);
        
        const statusDiv = document.getElementById('status');
        const messagesDiv = document.getElementById('messages');
        
        try {
            // Test adding a message
            const testMessage = {
                message: 'Test message from Firebase test',
                username: 'TestUser',
                timestamp: serverTimestamp()
            };
            
            console.log('Adding test message...');
            const docRef = await addDoc(collection(db, 'messages'), testMessage);
            console.log('Test message added with ID:', docRef.id);
            
            statusDiv.textContent = '✅ Firebase connection successful! Test message added.';
            statusDiv.style.color = 'green';
            
            // Listen to messages
            const messagesQuery = query(
                collection(db, 'messages'),
                orderBy('timestamp', 'asc'),
                limit(10)
            );
            
            onSnapshot(messagesQuery, (snapshot) => {
                console.log('Received snapshot with', snapshot.docs.length, 'documents');
                messagesDiv.innerHTML = '';
                
                snapshot.docs.forEach((doc) => {
                    const data = doc.data();
                    const messageDiv = document.createElement('div');
                    messageDiv.innerHTML = `<strong>${data.username}:</strong> ${data.message}`;
                    messageDiv.style.marginBottom = '10px';
                    messageDiv.style.padding = '5px';
                    messageDiv.style.border = '1px solid #ccc';
                    messagesDiv.appendChild(messageDiv);
                });
            });
            
        } catch (error) {
            console.error('Firebase test failed:', error);
            statusDiv.textContent = '❌ Firebase connection failed: ' + error.message;
            statusDiv.style.color = 'red';
        }
    </script>
</body>
</html>
